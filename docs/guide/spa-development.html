<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>React SPA Development - PHP React MVC Template</title>
    <meta name="description" content="Building React Single Page Applications that integrate seamlessly with the PHP backend">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff;
        }
        
        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #0366d6;
            margin-bottom: 1rem;
        }
        
        h2 {
            font-size: 2rem;
            font-weight: 600;
            color: #24292e;
            margin-top: 2rem;
            margin-bottom: 1rem;
            border-bottom: 1px solid #e1e4e8;
            padding-bottom: 0.3rem;
        }
        
        h3 {
            font-size: 1.5rem;
            font-weight: 600;
            color: #24292e;
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
        }
        
        h4 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #24292e;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
        }
        
        .subtitle {
            font-size: 1.25rem;
            font-weight: 300;
            color: #586069;
            margin-bottom: 2rem;
        }
        
        pre {
            background-color: #f6f8fa;
            border-radius: 6px;
            padding: 16px;
            overflow-x: auto;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
            font-size: 0.9rem;
            line-height: 1.45;
            border: 1px solid #e1e4e8;
        }
        
        code {
            background-color: #f3f4f6;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
            font-size: 0.9rem;
        }
        
        pre code {
            background-color: transparent;
            padding: 0;
        }
        
        ul, ol {
            margin: 1rem 0;
            padding-left: 2rem;
        }
        
        li {
            margin: 0.5rem 0;
        }
        
        strong {
            font-weight: 600;
        }
        
        hr {
            border: none;
            border-top: 1px solid #e1e4e8;
            margin: 2rem 0;
        }
        
        .nav-link {
            color: #0366d6;
            text-decoration: none;
        }
        
        .nav-link:hover {
            text-decoration: underline;
        }
        
        .toc {
            background-color: #f8f9fa;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            padding: 1rem;
            margin: 1rem 0;
        }
        
        .toc ul {
            margin: 0;
            padding-left: 1.5rem;
        }
    </style>
    <script src="../assets/sidebar.js"></script>
</head>
<body>
    <nav>
        <a href="../index.html" class="nav-link">← Back to Documentation</a>
    </nav>
    
    <h1>React SPA Development</h1>
    
    <p class="subtitle">Building React Single Page Applications that integrate seamlessly with the PHP backend using modern development patterns and architectural concepts.</p>
    
    <div class="toc">
        <h3>Table of Contents</h3>
        <ul>
            <li><a href="#how-spa-integration-works" class="nav-link">How SPA Integration Works</a></li>
            <li><a href="#api-integration-patterns" class="nav-link">API Integration Patterns</a></li>
            <li><a href="#vite-configuration" class="nav-link">Vite Configuration</a></li>
            <li><a href="#creating-spas" class="nav-link">Creating SPAs</a></li>
            <li><a href="#advanced-component-patterns" class="nav-link">Advanced Component Patterns</a></li>
            <li><a href="#components" class="nav-link">Components</a></li>
            <li><a href="#performance-optimization" class="nav-link">Performance Optimization</a></li>
            <li><a href="#state-management" class="nav-link">State Management</a></li>
            <li><a href="#api-integration" class="nav-link">API Integration</a></li>
            <li><a href="#testing-react-applications" class="nav-link">Testing React Applications</a></li>
            <li><a href="#deployment-and-production" class="nav-link">Deployment and Production</a></li>
            <li><a href="#forms-and-validation" class="nav-link">Forms and Validation</a></li>
            <li><a href="#routing-react-router" class="nav-link">Routing (React Router)</a></li>
            <li><a href="#build-and-development" class="nav-link">Build and Development</a></li>
            <li><a href="#php-integration" class="nav-link">PHP Integration</a></li>
            <li><a href="#best-practices" class="nav-link">Best Practices</a></li>
        </ul>
    </div>
    
    <hr>
    
    <h2 id="how-spa-integration-works">How SPA Integration Works</h2>
    
    <h3>Frontend-Backend Architecture</h3>
    
    <p>The template implements a <strong>micro-frontend</strong> approach where each React application is a separate module:</p>
    
    <pre><code>Backend API (PHP) ←→ React Module 1 (Dashboard)
                 ←→ React Module 2 (Admin Panel)  
                 ←→ React Module 3 (Public Site)</code></pre>
    
    <h3>Build System Integration</h3>
    
    <p><strong>Vite</strong> handles the React applications with hot module replacement and optimized builds:</p>
    
    <pre><code class="language-javascript">// vite.config.js - Multi-entry configuration
export default defineConfig({
  build: {
    rollupOptions: {
      input: {
        'afaq': './modules/Afaq/app.jsx',
        'app': './modules/App/app.jsx',
      },
      output: {
        entryFileNames: 'assets/[name]-[hash].js',
        chunkFileNames: 'assets/[name]-[hash].js',
        assetFileNames: 'assets/[name]-[hash].[ext]'
      }
    }
  },
  server: {
    proxy: {
      '/api': 'http://localhost:8000' // Proxy API calls to PHP
    }
  }
});</code></pre>
    
    <h3>Component Architecture Patterns</h3>
    
    <p>Each React module follows a consistent architectural pattern using modern React concepts:</p>
    
    <pre><code class="language-jsx">// modules/Dashboard/app.jsx - Entry point
import React from 'react';
import { createRoot } from 'react-dom/client';
import { AppProvider } from './contexts/AppContext';
import Home from './Home.jsx';
import './style.css';

function App() {
    return (
        &lt;AppProvider&gt;
            &lt;ErrorBoundary&gt;
                &lt;Home /&gt;
            &lt;/ErrorBoundary&gt;
        &lt;/AppProvider&gt;
    );
}

// Mount application with error handling
const container = document.getElementById('dashboard-app');
if (container) {
    const root = createRoot(container);
    root.render(&lt;App /&gt;);
} else {
    console.error('Dashboard container not found');
}</code></pre>
    
    <h3>State Management with Context API</h3>
    
    <p>Modern React applications use Context API with useReducer for complex state:</p>
    
    <pre><code class="language-jsx">// contexts/AppContext.jsx - Centralized state management
import React, { createContext, useContext, useReducer } from 'react';

const AppContext = createContext();

const initialState = {
    user: null,
    loading: false,
    error: null,
    notifications: []
};

function appReducer(state, action) {
    switch (action.type) {
        case 'SET_USER':
            return { ...state, user: action.payload, loading: false };
        case 'SET_LOADING':
            return { ...state, loading: action.payload };
        case 'SET_ERROR':
            return { ...state, error: action.payload, loading: false };
        case 'ADD_NOTIFICATION':
            return {
                ...state,
                notifications: [...state.notifications, action.payload]
            };
        default:
            return state;
    }
}

export function AppProvider({ children }) {
    const [state, dispatch] = useReducer(appReducer, initialState);
    
    return (
        &lt;AppContext.Provider value={{\{state, dispatch\}\}}&gt;
            {children}
        &lt;/AppContext.Provider&gt;
    );
}

export function useApp() {
    const context = useContext(AppContext);
    if (!context) {
        throw new Error('useApp must be used within AppProvider');
    }
    return context;
}</code></pre>
    
    <hr>
    
    <h2 id="api-integration-patterns">API Integration Patterns</h2>
    
    <h3>Custom Hooks for Data Fetching</h3>
    
    <p>React applications use custom hooks to interact with the PHP backend API:</p>
    
    <pre><code class="language-jsx">// hooks/useApi.js - Reusable API hook with error handling
import { useState, useEffect } from 'react';
import { useApp } from '../contexts/AppContext';

export function useApi(url, options = {}) {
    const [data, setData] = useState(null);
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState(null);
    const { dispatch } = useApp();

    useEffect(() => {
        const fetchData = async () => {
            try {
                setLoading(true);
                const response = await fetch(`/api${url}`, {
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest',
                        ...options.headers
                    },
                    ...options
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const result = await response.json();
                setData(result);
                setError(null);
            } catch (err) {
                setError(err.message);
                dispatch({ type: 'SET_ERROR', payload: err.message });
            } finally {
                setLoading(false);
            }
        };

        fetchData();
    }, [url, options.method]);

    return { data, loading, error };
}</code></pre>
    
    <h3>Authentication Hook</h3>
    
    <pre><code class="language-jsx">// hooks/useAuth.js - Authentication state management
export function useAuth() {
    const { state, dispatch } = useApp();
    
    const login = async (credentials) => {
        dispatch({ type: 'SET_LOADING', payload: true });
        try {
            const response = await fetch('/api/auth/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(credentials)
            });
            
            const data = await response.json();
            if (data.success) {
                dispatch({ type: 'SET_USER', payload: data.user });
                localStorage.setItem('token', data.token);
                return true;
            }
            throw new Error(data.message);
        } catch (error) {
            dispatch({ type: 'SET_ERROR', payload: error.message });
            return false;
        }
    };

    const logout = () => {
        dispatch({ type: 'SET_USER', payload: null });
        localStorage.removeItem('token');
    };

    return { user: state.user, login, logout, loading: state.loading };
}</code></pre>
    
    <hr>
    
    <h2 id="performance-optimization">Performance Optimization</h2>
    
    <h3>Virtual Scrolling for Large Lists</h3>
    
    <p>Handle large datasets efficiently:</p>
    
    <pre><code class="language-jsx">// components/VirtualList.jsx - Virtual scrolling implementation
import React, { useState, useEffect, useRef, useMemo } from 'react';

function VirtualList({ 
    items, 
    itemHeight = 50, 
    containerHeight = 400,
    renderItem 
}) {
    const [scrollTop, setScrollTop] = useState(0);
    const containerRef = useRef();

    // Calculate visible range
    const visibleRange = useMemo(() => {
        const start = Math.floor(scrollTop / itemHeight);
        const visibleCount = Math.ceil(containerHeight / itemHeight);
        const end = Math.min(start + visibleCount + 1, items.length);
        
        return { start, end };
    }, [scrollTop, itemHeight, containerHeight, items.length]);

    // Calculate total height and visible items
    const totalHeight = items.length * itemHeight;
    const visibleItems = items.slice(visibleRange.start, visibleRange.end);

    const handleScroll = (e) => {
        setScrollTop(e.target.scrollTop);
    };

    return (
        &lt;div
            ref={containerRef}
            className="virtual-list"
            style={{\{ height: containerHeight, overflow: 'auto' \}\}}
            onScroll={handleScroll}
        &gt;
            &lt;div style={{\{ height: totalHeight, position: 'relative' \}\}}&gt;
                &lt;div
                    style={{\{
                        transform: \`translateY(\$\{visibleRange.start * itemHeight\}px)\`,
                        position: 'absolute',
                        width: '100%'
                    \}\}}
                &gt;
                    {visibleItems.map((item, index) => (
                        &lt;div
                            key={visibleRange.start + index}
                            style={{\{ height: itemHeight \}\}}
                        &gt;
                            {renderItem(item, visibleRange.start + index)}
                        &lt;/div&gt;
                    ))}
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    );
}</code></pre>
    
    <hr>
    
    <h2 id="testing-react-applications">Testing React Applications</h2>
    
    <h3>Unit Testing with Jest and React Testing Library</h3>
    
    <p>Modern React testing focuses on testing user behavior rather than implementation details:</p>
    
    <pre><code class="language-jsx">// __tests__/components/UserCard.test.jsx
import React from 'react';
import { render, screen, fireEvent, waitFor } from '@testing-library/react';
import { jest } from '@jest/globals';
import UserCard from '../components/UserCard';

// Mock the API module
jest.mock('../services/api', () => ({
    updateUser: jest.fn(),
    deleteUser: jest.fn()
}));

describe('UserCard Component', () => {
    const mockUser = {
        id: 1,
        name: 'John Doe',
        email: 'john@example.com',
        avatar: '/avatar.jpg'
    };

    const mockProps = {
        user: mockUser,
        onEdit: jest.fn(),
        onDelete: jest.fn()
    };

    beforeEach(() => {
        jest.clearAllMocks();
    });

    test('renders user information correctly', () => {
        render(&lt;UserCard {...mockProps} /&gt;);
        
        expect(screen.getByText('John Doe')).toBeInTheDocument();
        expect(screen.getByText('john@example.com')).toBeInTheDocument();
        expect(screen.getByRole('img')).toHaveAttribute('src', '/avatar.jpg');
    });

    test('calls onEdit when edit button is clicked', () => {
        render(&lt;UserCard {...mockProps} /&gt;);
        
        fireEvent.click(screen.getByText('Edit'));
        expect(mockProps.onEdit).toHaveBeenCalledWith(mockUser);
    });
});</code></pre>
    
    <hr>
    
    <h2 id="php-integration">PHP Integration</h2>
    
    <h3>Loading SPAs in PHP Views</h3>
    
    <pre><code class="language-php">&lt;!-- views/template/react_shell.php --&gt;
&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;title&gt;&lt;?= $title ?? 'My App' ?&gt;&lt;/title&gt;
    &lt;?php if (isset($styles)): ?&gt;
        &lt;?php foreach ($styles as $style): ?&gt;
            &lt;link rel="stylesheet" href="&lt;?= $style ?&gt;"&gt;
        &lt;?php endforeach; ?&gt;
    &lt;?php endif; ?&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div id="root"&gt;&lt;/div&gt;
    
    &lt;!-- Pass PHP data to React --&gt;
    &lt;script&gt;
        window.APP_DATA = {
            user: &lt;?= json_encode($user ?? null) ?&gt;,
            config: &lt;?= json_encode($config ?? []) ?&gt;,
            csrf_token: '&lt;?= csrf_token() ?&gt;'
        };
    &lt;/script&gt;
    
    &lt;?php if (isset($scripts)): ?&gt;
        &lt;?php foreach ($scripts as $script): ?&gt;
            &lt;script src="&lt;?= $script ?&gt;"&gt;&lt;/script&gt;
        &lt;?php endforeach; ?&gt;
    &lt;?php endif; ?&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
    
    <hr>
    
    <h2 id="best-practices">Best Practices</h2>
    
    <h3>1. Component Organization</h3>
    
    <pre><code>modules/
├── shared/           # Shared components and utilities
│   ├── components/
│   ├── hooks/
│   ├── services/
│   └── utils/
└── [SpaName]/        # Individual SPA modules
    ├── app.jsx       # Entry point
    ├── components/   # SPA-specific components
    ├── hooks/        # Custom hooks
    └── styles/       # CSS files</code></pre>
    
    <h3>2. Code Splitting</h3>
    
    <pre><code class="language-jsx">// Lazy load components
import React, { lazy, Suspense } from 'react';

const UserList = lazy(() => import('./components/UserList.jsx'));
const Settings = lazy(() => import('./components/Settings.jsx'));

function App() {
    return (
        &lt;Suspense fallback={&lt;div&gt;Loading...&lt;/div&gt;}&gt;
            &lt;Routes&gt;
                &lt;Route path="/users" element={&lt;UserList /&gt;} /&gt;
                &lt;Route path="/settings" element={&lt;Settings /&gt;} /&gt;
            &lt;/Routes&gt;
        &lt;/Suspense&gt;
    );
}</code></pre>
    
    <p>This setup provides a powerful foundation for building modern React SPAs that integrate seamlessly with your PHP backend.</p>
</body>
</html>
